<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<link rel="text" href="bootstrap.css"/>
<body>
<div id="main" style="width: 1200px;height:400px;"></div>
<script src="../js/echarts.js"></script>
<script>

    var cellSize = [80, 80];
    var pieRadius = 20;
    var myChart = echarts.init(document.getElementById("main"));
    function getVirtulData() {
        var date = +echarts.number.parseDate('2017/2/1');
        var end = +echarts.number.parseDate('2017/3/1');
        var dayTime = 3600 * 24 * 1000;
        var data = [];
        for (var time = date; time < end; time += dayTime) {
            data.push([
                echarts.format.formatTime('yyyy/MM/dd', time),
                Math.floor(Math.random() * 10000)
            ]);
        }
        return data;
    }

    function getPieSeries(scatterData, chart) {
        return echarts.util.map(scatterData, function (item, index) {
            console.log(item)
            var center = chart.convertToPixel('grid', item);
            return {
                id: index + 'pie',
                type: 'pie',
                center: center,
                label: {
                    normal: {
                        formatter: '{c}',
                        position: 'inside'
                    }
                },
                itemStyle:{
                    normal:{
                        color:(item)=>{
                            console.log(item)
                            if(item.percent>0&&(item.percent<=3.85)){
                                return "red"
                            }else if(item.percent>3.85&&(item.percent<=19.23)){
                                return "green"
                            }else{
                                return "blue"
                            }
                        }
                    }
                },
                radius: [20,10],
                data: [
                    {name: '工作', value: 1},
                    {name: '娱乐', value: 5},
                    {name: '睡觉', value: 20}
                ]
            };
        });
    }

    function getPieSeriesUpdate(scatterData, chart) {
        return echarts.util.map(scatterData, function (item, index) {
            var center = chart.convertToPixel('calendar', item);
            return {
                id: index + 'pie',
                center: center
            };
        });
    }

    var scatterData = getVirtulData();
    var axData = []
    scatterData.map(function (value,index) {
        axData.push(value[0])
    })
    option = {
        tooltip : {},
        legend: {
            data: ['工作', '娱乐', '睡觉'],
            bottom: 20
        },
        grid:{
            left:0,right:0
        },
        xAxis: [{
            axisLabel: {
                interval: 50,
                rotate: 45
            },
            type: 'category',
            data: axData
        }],
        dataZoom: [
            {
                show: true,
                realtime: true,
                start: 60,
                end: 70,

            },
            {
                type: 'inside',
                realtime: true,
                start: 30,
                end: 70,

            }
        ],
        yAxis: {},

        series: [{
            id: 'label',
            type: 'scatter',
            symbolSize: 10,
            label: {
                normal: {
                    show: false,
                    formatter: function (params) {
                        return echarts.format.formatTime('dd', params.value[0]);
                    },
                    offset: [-cellSize[0] / 2 + 10, -cellSize[1] / 2 + 10],
                    textStyle: {
                        color: '#000',
                        fontSize: 14
                    }
                }
            },
            itemStyle:{
                normal:{
                    opacity:0
                }
            },
            data: scatterData
        }]
    };
    console.log(scatterData)
    myChart.setOption(option);

    myChart.dispatchAction({
        type: 'dataZoom',
        batch: [{
            // 第一个 dataZoom 组件
            start: 20,
            end: 30
        }, {
            // 第二个 dataZoom 组件
            dataZoomIndex: 1,
            start: 10,
            end: 20
        }]
    })
    myChart.on("dataZoom",function () {
        console.log("dataZoom")
        myChart.setOption({series: getPieSeries(scatterData, myChart)});
    })
        var app = window
        var pieInitialized;
        setTimeout(function () {
            pieInitialized = true;
            myChart.setOption({series: getPieSeries(scatterData, myChart)});
        }, 10);

      /*  app.onresize = function () {
            if (pieInitialized) {
                myChart.setOption({
                    series: getPieSeriesUpdate(scatterData, myChart)
                });
            }
        };*/

</script>
</body>
</html>